/* ---------- Local Storage (with migration) ---------- */
const LS_TASKS="cc_tasks_v31";
const LS_BLOCKS="cc_blocks_v31";
const LS_SETTINGS="cc_settings_v31";
const load = (k,fb) => { try { const raw=localStorage.getItem(k); return raw?JSON.parse(raw):fb } catch { return fb } };
const save = (k,v) => { try { localStorage.setItem(k, JSON.stringify(v)) } catch {} };

/* Try to pull from older keys on first run */
function migrateIfEmpty() {
  // Any possible old keys from earlier versions
  const OLD_TASK_KEYS = ["cc_tasks_v30","cc_tasks_v3","cc_tasks","tasks"];
  const OLD_BLOCK_KEYS = ["cc_blocks_v30","cc_blocks","blocks"];
  const OLD_SETTINGS_KEYS = ["cc_settings_v30","cc_settings","settings"];

  const currTasks = load(LS_TASKS, []);
  const currBlocks = load(LS_BLOCKS, []);
  const currSettings = load(LS_SETTINGS, null);

  let migrated = false;

  if (!currTasks.length) {
    for (const k of OLD_TASK_KEYS) {
      const val = load(k, []);
      if (Array.isArray(val) && val.length) {
        save(LS_TASKS, val);
        migrated = true;
        break;
      }
    }
  }
  if (!currBlocks.length) {
    for (const k of OLD_BLOCK_KEYS) {
      const val = load(k, []);
      if (Array.isArray(val) && val.length) {
        save(LS_BLOCKS, val);
        migrated = true;
        break;
      }
    }
  }
  if (currSettings == null) {
    for (const k of OLD_SETTINGS_KEYS) {
      const val = load(k, null);
      if (val && typeof val === "object") {
        save(LS_SETTINGS, val);
        migrated = true;
        break;
      }
    }
  }

  if (migrated) console.log("✅ Chaos Control migration complete — data restored from older keys");
  else console.log("ℹ️ No older data found to migrate");
}
